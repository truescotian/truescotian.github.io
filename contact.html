<html>
  <head>
    <title>Contact Greg Miller</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/contact.css" />
    <link rel="stylesheet" href="css/nav.css" />
  </head>
  <body>
    <main>
      <header>
        <nav>
          <a href="index.html" class="indexMenuItem">DOG</a>
          <a href="about.html" class="indexMenuItem">ABOUT</a>
          <a href="resume.html" class="indexMenuItem">RESUME</a>
          <a href="contact.html" class="indexMenuItem">CONTACT</a>
        </nav>
      </header>
      <div class="page">
        <div class="container">
          <h1>Let's work.</h1>
          <p>Fill out the form and I will get back to you soon :)</p>
          <form class="form" id="contactForm">
            <p id="errorMsg"></p>
            <p id="successMsg"></p>

            <label class="label" htmlFor="yourName"> Your Name </label>
            <input type="text" id="name" required />

            <label class="label" htmlFor="yourEmail"> Your Email </label>
            <input type="email" id="email" required />

            <label class="label" htmlFor="message"> Your Message </label>
            <textarea
              class="textArea"
              id="message"
              placeholder="Type your message here..."
              required
            ></textarea>

            <input type="submit" class="btn" id="buttonTest" value="Send" />
          </form>
        </div>
      </div>
    </main>
  </body>

  <script>
    var form = document.getElementById("contactForm");
    var btn = document.getElementById("buttonTest");

    async function submitForm(e) {
      e.preventDefault();
      document.getElementById("successMsg").innerHTML = "";
      document.getElementById("successMsg").classList.remove("success");
      document.getElementById("errorMsg").innerHTML = "";
      document.getElementById("errorMsg").classList.remove("error");

      btn.value = "Sending...";

      try {
        const body = {
          body: document.getElementById("message").value,
          name: document.getElementById("name").value,
          sender: document.getElementById("email").value,
        };
        await fetch(
          `https://jefa8nm609.execute-api.ca-central-1.amazonaws.com/Production/email`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body),
          }
        );
        document.getElementById("successMsg").classList.add("success");
        document.getElementById("successMsg").innerHTML = "Email Sent!";
      } catch (error) {
        console.error(error);
        document.getElementById("errorMsg").classList.add("error");
        document.getElementById("errorMsg").innerHTML =
          "Unable to send email. Please contact gregpmillr@gmail.com directly.";
      }

      btn.value = "Send";
    }

    form.addEventListener("submit", submitForm);
  </script>
</html>
